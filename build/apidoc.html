<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://waterlock.ninja/"

    >waterlock (v0.1.0)</a>
</h1>
<h4>User authentication and Json Web Tokens for Sails</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.waterlock">module waterlock</a><ol>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">waterlock.</span>attempt</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">waterlock.</span>auth</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">waterlock.</span>jwt</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">waterlock.</span>use</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">waterlock.</span>user</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">waterlock.</span>utils</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.waterlock.attempt">module waterlock.attempt</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.attempt.attributes">
            function <span class="apidocSignatureSpan">waterlock.attempt.</span>attributes
            <span class="apidocSignatureSpan">(attributes)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.waterlock.auth">module waterlock.auth</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.auth.attributes">
            function <span class="apidocSignatureSpan">waterlock.auth.</span>attributes
            <span class="apidocSignatureSpan">(attributes)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.auth.beforeCreate">
            function <span class="apidocSignatureSpan">waterlock.auth.</span>beforeCreate
            <span class="apidocSignatureSpan">(values, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.auth.beforeUpdate">
            function <span class="apidocSignatureSpan">waterlock.auth.</span>beforeUpdate
            <span class="apidocSignatureSpan">(values, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.waterlock.jwt">module waterlock.jwt</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.jwt.attributes">
            function <span class="apidocSignatureSpan">waterlock.jwt.</span>attributes
            <span class="apidocSignatureSpan">(attributes)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.waterlock.use">module waterlock.use</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.use.attributes">
            function <span class="apidocSignatureSpan">waterlock.use.</span>attributes
            <span class="apidocSignatureSpan">(attributes)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.waterlock.user">module waterlock.user</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.user.attributes">
            function <span class="apidocSignatureSpan">waterlock.user.</span>attributes
            <span class="apidocSignatureSpan">(attributes)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.waterlock.utils">module waterlock.utils</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.utils.accessObjectLikeArray">
            function <span class="apidocSignatureSpan">waterlock.utils.</span>accessObjectLikeArray
            <span class="apidocSignatureSpan">(index, obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.utils.allParams">
            function <span class="apidocSignatureSpan">waterlock.utils.</span>allParams
            <span class="apidocSignatureSpan">(req)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.utils.countTopLevel">
            function <span class="apidocSignatureSpan">waterlock.utils.</span>countTopLevel
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.waterlock.utils.createJwt">
            function <span class="apidocSignatureSpan">waterlock.utils.</span>createJwt
            <span class="apidocSignatureSpan">(req, res, user)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.waterlock" id="apidoc.module.waterlock">module waterlock</a></h1>













</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.waterlock.attempt" id="apidoc.module.waterlock.attempt">module waterlock.attempt</a></h1>


    <h2>
        <a href="#apidoc.element.waterlock.attempt.attributes" id="apidoc.element.waterlock.attempt.attributes">
        function <span class="apidocSignatureSpan">waterlock.attempt.</span>attributes
        <span class="apidocSignatureSpan">(attributes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">attributes = function (attributes){
  var _ = require(&#x27;lodash&#x27;);

  var template = {
    user:{
      model: &#x27;user&#x27;
    },
    successful:{
      type: &#x27;boolean&#x27;,
      defaultsTo: false
    },
    ip:{
      type: &#x27;string&#x27;
    },
    port:{
      type: &#x27;string&#x27;
    }
  };

  return _.merge(template, attributes);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```

now with your policies applied to your custom controller you&#x27;re good to go! (given you&#x27;ve actually implemented some login
 in them e.g. `res.view()`)

# How can I customize it?
Waterlock wraps around models and controllers so you can override any of the actions and definition that are predefined. After running
 `waterlock generate all` open up the `User.js` file you&#x27;ll see this:
```js
  attributes: require(&#x27;waterlock&#x27;).models.user.<span class="apidocCodeKeywordSpan">attributes</span>({

    /* e.g.
    nickname: &#x27;string&#x27;
    */

  }),
```
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.waterlock.auth" id="apidoc.module.waterlock.auth">module waterlock.auth</a></h1>


    <h2>
        <a href="#apidoc.element.waterlock.auth.attributes" id="apidoc.element.waterlock.auth.attributes">
        function <span class="apidocSignatureSpan">waterlock.auth.</span>attributes
        <span class="apidocSignatureSpan">(attributes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">attributes = function (attributes){
  var _ = require(&#x27;lodash&#x27;);
  var methods = waterlock.methods;

  for(var key in methods){
    var method = methods[key];
    if(method.hasOwnProperty(&#x27;model&#x27;)){
      // call the decorator of each auth method
      method.model.auth.attributes(attributes);
    }
  }

  var template = {
    user:{
      model: &#x27;user&#x27;
    }
  };

  return _.merge(template, attributes);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```

now with your policies applied to your custom controller you&#x27;re good to go! (given you&#x27;ve actually implemented some login
 in them e.g. `res.view()`)

# How can I customize it?
Waterlock wraps around models and controllers so you can override any of the actions and definition that are predefined. After running
 `waterlock generate all` open up the `User.js` file you&#x27;ll see this:
```js
  attributes: require(&#x27;waterlock&#x27;).models.user.<span class="apidocCodeKeywordSpan">attributes</span>({

    /* e.g.
    nickname: &#x27;string&#x27;
    */

  }),
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.waterlock.auth.beforeCreate" id="apidoc.element.waterlock.auth.beforeCreate">
        function <span class="apidocSignatureSpan">waterlock.auth.</span>beforeCreate
        <span class="apidocSignatureSpan">(values, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">beforeCreate = function (values, cb){
  var methods = waterlock.methods;
  for(var key in methods){
    var model = methods[key].model.auth;
    if(model.hasOwnProperty(&#x27;beforeCreate&#x27;)){
      model.beforeCreate(values);
    }
  }

  cb();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @param  {Function} cb
 */
exports.beforeCreate = function(values, cb){
  var methods = waterlock.methods;
  for(var key in methods){
    var model = methods[key].model.auth;
    if(model.hasOwnProperty(&#x27;beforeCreate&#x27;)){
      model.<span class="apidocCodeKeywordSpan">beforeCreate</span>(values);
    }
  }

  cb();
};

/**
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.waterlock.auth.beforeUpdate" id="apidoc.element.waterlock.auth.beforeUpdate">
        function <span class="apidocSignatureSpan">waterlock.auth.</span>beforeUpdate
        <span class="apidocSignatureSpan">(values, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">beforeUpdate = function (values, cb){
  var methods = waterlock.methods;
  for(var key in methods){
    var model = methods[key].model.auth;
    if(model.hasOwnProperty(&#x27;beforeUpdate&#x27;)){
      model.beforeUpdate(values);
    }
  }

  cb();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @param  {Function} cb
 */
exports.beforeUpdate = function(values, cb){
  var methods = waterlock.methods;
  for(var key in methods){
    var model = methods[key].model.auth;
    if(model.hasOwnProperty(&#x27;beforeUpdate&#x27;)){
      model.<span class="apidocCodeKeywordSpan">beforeUpdate</span>(values);
    }
  }

  cb();
};
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.waterlock.jwt" id="apidoc.module.waterlock.jwt">module waterlock.jwt</a></h1>


    <h2>
        <a href="#apidoc.element.waterlock.jwt.attributes" id="apidoc.element.waterlock.jwt.attributes">
        function <span class="apidocSignatureSpan">waterlock.jwt.</span>attributes
        <span class="apidocSignatureSpan">(attributes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">attributes = function (attributes){
  var _ = require(&#x27;lodash&#x27;);

  var template = {
    token: {
      type: &#x27;text&#x27;,
      maxLength: 512
    },
    uses: {
      collection: &#x27;use&#x27;,
      via: &#x27;jsonWebToken&#x27;
    },
    owner: {
      model: &#x27;user&#x27;
    },
    revoked: {
      type: &#x27;boolean&#x27;,
      defaultsTo: false
    }
  };

  return _.merge(template, attributes);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```

now with your policies applied to your custom controller you&#x27;re good to go! (given you&#x27;ve actually implemented some login
 in them e.g. `res.view()`)

# How can I customize it?
Waterlock wraps around models and controllers so you can override any of the actions and definition that are predefined. After running
 `waterlock generate all` open up the `User.js` file you&#x27;ll see this:
```js
  attributes: require(&#x27;waterlock&#x27;).models.user.<span class="apidocCodeKeywordSpan">attributes</span>({

    /* e.g.
    nickname: &#x27;string&#x27;
    */

  }),
```
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.waterlock.use" id="apidoc.module.waterlock.use">module waterlock.use</a></h1>


    <h2>
        <a href="#apidoc.element.waterlock.use.attributes" id="apidoc.element.waterlock.use.attributes">
        function <span class="apidocSignatureSpan">waterlock.use.</span>attributes
        <span class="apidocSignatureSpan">(attributes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">attributes = function (attributes){
  var _ = require(&#x27;lodash&#x27;);

  var template = {
    remoteAddress: {
      type: &#x27;string&#x27;
    },
    jsonWebToken: {
      model: &#x27;jwt&#x27;
    },
  };

  return _.merge(template, attributes);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```

now with your policies applied to your custom controller you&#x27;re good to go! (given you&#x27;ve actually implemented some login
 in them e.g. `res.view()`)

# How can I customize it?
Waterlock wraps around models and controllers so you can override any of the actions and definition that are predefined. After running
 `waterlock generate all` open up the `User.js` file you&#x27;ll see this:
```js
  attributes: require(&#x27;waterlock&#x27;).models.user.<span class="apidocCodeKeywordSpan">attributes</span>({

    /* e.g.
    nickname: &#x27;string&#x27;
    */

  }),
```
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.waterlock.user" id="apidoc.module.waterlock.user">module waterlock.user</a></h1>


    <h2>
        <a href="#apidoc.element.waterlock.user.attributes" id="apidoc.element.waterlock.user.attributes">
        function <span class="apidocSignatureSpan">waterlock.user.</span>attributes
        <span class="apidocSignatureSpan">(attributes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">attributes = function (attributes){
  var _ = require(&#x27;lodash&#x27;);


  var template = {
    attempts: {
      collection: &#x27;attempt&#x27;,
      via: &#x27;user&#x27;
    },
    jsonWebTokens: {
      collection: &#x27;jwt&#x27;,
      via: &#x27;owner&#x27;
    },
    auth:{
      model: &#x27;auth&#x27;
    }
  };

  return _.merge(template, attributes);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```

now with your policies applied to your custom controller you&#x27;re good to go! (given you&#x27;ve actually implemented some login
 in them e.g. `res.view()`)

# How can I customize it?
Waterlock wraps around models and controllers so you can override any of the actions and definition that are predefined. After running
 `waterlock generate all` open up the `User.js` file you&#x27;ll see this:
```js
  attributes: require(&#x27;waterlock&#x27;).models.user.<span class="apidocCodeKeywordSpan">attributes</span>({

    /* e.g.
    nickname: &#x27;string&#x27;
    */

  }),
```
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.waterlock.utils" id="apidoc.module.waterlock.utils">module waterlock.utils</a></h1>


    <h2>
        <a href="#apidoc.element.waterlock.utils.accessObjectLikeArray" id="apidoc.element.waterlock.utils.accessObjectLikeArray">
        function <span class="apidocSignatureSpan">waterlock.utils.</span>accessObjectLikeArray
        <span class="apidocSignatureSpan">(index, obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">accessObjectLikeArray = function (index, obj){
  // if obj is not an object just return it nothing to do
  if(typeof obj !== &#x27;object&#x27;){
    return obj;
  }

  // if object already is an array return the value at given index
  if(typeof obj[index] !== &#x27;undefined&#x27;){
    return obj[index];
  }

  var count = 0;
  for(var key in obj){
    if(count === index){
      return obj[key];
    }
    count++;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * GET /auth/login
 */
module.exports = function(req, res){
var params = waterlock._utils.allParams(req);

// If there is only 1 chosen auth method just assume it
if(waterlock._utils.countTopLevel(waterlock.methods) === 1){
  params.type = waterlock._utils.<span class="apidocCodeKeywordSpan">accessObjectLikeArray</span>(0, waterlock.methods).authType
;
}

if(typeof params.type === &#x27;undefined&#x27;){
  return res.badRequest(&#x27;You must specify a type parameter.&#x27;);
}

if(waterlock.methods.hasOwnProperty(params.type)){
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.waterlock.utils.allParams" id="apidoc.element.waterlock.utils.allParams">
        function <span class="apidocSignatureSpan">waterlock.utils.</span>allParams
        <span class="apidocSignatureSpan">(req)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">allParams = function (req){
  var params = req.params.all();
  _.merge(params, req.headers);
  return _.merge(params, req.query);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
     *
     * @param  {Express request}   req the Express request object
     * @param  {Function} cb  Callback when to be called when token
     *                        has been validated or an error has occured
     */
    validateTokenRequest: function(req, cb){
      var self = this;
      var token = waterlock._utils.<span class="apidocCodeKeywordSpan">allParams</span>(req).access_token;

      if(token){

// validate the token
this.validateToken(token, function(err, user){
  if(err){
    waterlock.logger.debug(err);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.waterlock.utils.countTopLevel" id="apidoc.element.waterlock.utils.countTopLevel">
        function <span class="apidocSignatureSpan">waterlock.utils.</span>countTopLevel
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">countTopLevel = function (obj){
  if(typeof obj !== &#x27;object&#x27;){
    return -1;
  }

  var count = 0;
  for(var key in obj){
    if(obj.hasOwnProperty(key)){
      count++;
    }
  }
  return count;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *
 * GET /auth/login
 */
module.exports = function(req, res){
var params = waterlock._utils.allParams(req);

// If there is only 1 chosen auth method just assume it
if(waterlock._utils.<span class="apidocCodeKeywordSpan">countTopLevel</span>(waterlock.methods) === 1){
  params.type = waterlock._utils.accessObjectLikeArray(0, waterlock.methods).authType;
}

if(typeof params.type === &#x27;undefined&#x27;){
  return res.badRequest(&#x27;You must specify a type parameter.&#x27;);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.waterlock.utils.createJwt" id="apidoc.element.waterlock.utils.createJwt">
        function <span class="apidocSignatureSpan">waterlock.utils.</span>createJwt
        <span class="apidocSignatureSpan">(req, res, user)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createJwt = function (req, res, user) {
  var jsonWebTokens = waterlock.config.jsonWebTokens || {};
  var expiryUnit = (jsonWebTokens.expiry &#x26;&#x26; jsonWebTokens.expiry.unit) || &#x27;days&#x27;;
  var expiryLength = (jsonWebTokens.expiry &#x26;&#x26; jsonWebTokens.expiry.length) || 7;
  var expires = moment().add(expiryLength, expiryUnit).valueOf();
  var issued = Date.now();
  user = user || req.session.user;

  var token = jwt.encode({
    iss: user.id + &#x27;|&#x27; + req.remoteAddress,
    sub: jsonWebTokens.subject,
    aud: jsonWebTokens.audience,
    exp: expires,
    nbf: issued,
    iat: issued,
    jti: uuid.v1()
  }, jsonWebTokens.secret);

  return {
    token: token,
    expires: expires
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      req.session.authenticated = true;

      // now respond or redirect
      var postResponse = this._resolvePostAction(waterlock.config.postActions.register.success, user);

      if (postResponse === &#x27;jwt&#x27;) {
        //Returns the token immediately
        var jwtData = waterlock._utils.<span class="apidocCodeKeywordSpan">createJwt</span>(req, res, user);

        Jwt.create({token: jwtData.token, uses: 0, owner: user.id}).exec(function(err){
if(err){
  return res.serverError(&#x27;JSON web token could not be created&#x27;);
}

var result = {};
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
